<html>

<head>
    <meta charset="utf-8">
    
    <title>Vulnerability Discovery | caketi</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/favicon/favicon.ico">
    
<link rel="stylesheet" href="/css/main.css">

    
<link rel="stylesheet" href="/css/tagplugins.css">

    
<link rel="stylesheet" href="/css/highlight.css">

    


    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="caketi" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div class="blog-header">
   <a id="menu-nav-icon"><img src="/image/menu.png"/></a>
   <div class="nav-container">
     <nav id="main-nav">
       
         <a class="main-nav-link" href="/">Home</a>
       
         <a class="main-nav-link" href="/archives">Archives</a>
       
     </nav>
   </div>
   <!--
   <div id="search-form-wrap">
     <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
   </div>
 -->
    <h1 class="blog-title">caketi</h1>
    <p class="lead blog-description">Ultraman Orb(红凯)</p>
</div>

  <div id='main-part'>
      <div class="main">
<div class="blog-post">
    <!-- Title -->
    <h1 class="blog-post-title">
        <a href="/2020/09/17/Vulnerability Discvoery/">
            Vulnerability Discovery
        </a>
    </h1>
    <!-- Date and Author -->
    <p class="blog-post-meta">
        2020-09-17
        
    </p>

    

    <!-- Content -->
    <a id="more"></a>
<p>#Security Automation<br>most common security automation :</p>
<ul>
<li>Static analysis</li>
<li>Dynamic analysis</li>
<li>Vulnerability regression testing<br>Many robust and powerful static analysis tools exist, such as the following:</li>
<li>Checkmarx (most major languages—paid)</li>
<li>PMD (Java—free)</li>
<li>Bandit (Python—free)</li>
<li>Brakeman (Ruby—free)</li>
</ul>
<p>General XSS<br>    Look for DOM manipulation with innerHTML.<br>Reflected XSS<br>    Look for variables pulled from a URL param.</p>
<p>DOM XSS<br>    Look for specific DOM sinks like setInterval().<br>SQL Injection<br>    Look for user-provided strings being used in queries.<br>CSRF<br>    Look for state-changing GET requests.<br>DoS<br>    Look for improperly written regular expressions.</p>
<blockquote>
<p>Additionally, static analysis suffers when dealing with dynamic languages (like Java‐<br>Script). Statically typed languages like Java or C# are much easier to perform static<br>analysis on, as the tooling understands the expected data type, and that data cannot<br>change type as it traverses through functions and classes.<br>#Dynamic Analysis</p>
</blockquote>
<p>Dynamic analysis tools exist for many languages and frameworks. Some examples of<br>these are:</p>
<ul>
<li>IBM AppScan (paid)</li>
<li>Veracode (paid)</li>
<li>Iroh (free)<br>#Vulnerability Regression Testing<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> currentUser = <span class="built_in">require</span>(<span class="string">&#x27;../currentUser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> modifySubscription = <span class="built_in">require</span>(<span class="string">&#x27;../../modifySubscription&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> tiers = [<span class="string">&#x27;individual&#x27;</span>, <span class="string">&#x27;business&#x27;</span>, <span class="string">&#x27;corporation&#x27;</span>];</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Takes an HTTP GET on behalf of the currently authenticated user.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Takes a param `newTier` and attempts to update the authenticated</span></span><br><span class="line"><span class="comment"> * user&#x27;s subscription to that tier.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">app.get(<span class="string">&#x27;/changeSubscriptionTier&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!currentUser.isAuthenticated) &#123; <span class="keyword">return</span> res.sendStatus(<span class="number">401</span>); &#125;</span><br><span class="line"><span class="keyword">if</span> (!req.params.newTier) &#123; <span class="keyword">return</span> res.sendStatus(<span class="number">400</span>); &#125;</span><br><span class="line"><span class="keyword">if</span> (!tiers.includes(req.params.newTier)) &#123; <span class="keyword">return</span> res.sendStatus(<span class="number">400</span>); &#125;</span><br><span class="line">Security Automation | <span class="number">219</span></span><br><span class="line">modifySubscription(currentUser, req.params.newTier)</span><br><span class="line">.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> res.sendStatus(<span class="number">200</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">return</span> res.sendStatus(<span class="number">400</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
make a request like GET /api/changeSubscriptionTier with any tier as the newTier<br>param and sends it via hyperlink to Steve. When Steve clicks this link, a request is<br>made on behalf of his account, changing the state of his subscription in his company’s<h1 id="application-portal"><a href="#application-portal" class="headerlink" title="application portal."></a>application portal.</h1>Jed has discovered a CSRF vulnerability in the application. Luckily, although Steve is<br>annoyed by Jed’s constant critiquing, he realizes the danger of this exploit and reports<br>it back to his organization for triaging. Once triaged, the solution is to switch the<br>request from an HTTP GET to an HTTP POST instead.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tester = <span class="built_in">require</span>(<span class="string">&#x27;tester&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> requester = <span class="built_in">require</span>(<span class="string">&#x27;requester&#x27;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Checks the HTTP Options of the `changeSubscriptionTier` endpoint.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Fails if more than one verb is accepted, or the verb is not equal</span></span><br><span class="line"><span class="comment"> * to &#x27;POST&#x27;.</span></span><br><span class="line"><span class="comment"> * Fails on timeout or unsuccessful options request.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> testTierChange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">requester.options(<span class="string">&#x27;http://app.com/api/changeSubscriptionTier&#x27;</span>)</span><br><span class="line"> .on(<span class="string">&#x27;response&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (!res.headers) &#123;</span><br><span class="line"> <span class="keyword">return</span> tester.fail();</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> verbs = res.headers[<span class="string">&#x27;Allow&#x27;</span>].split(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line"> <span class="keyword">if</span> (verbs.length &gt; <span class="number">1</span>) &#123; <span class="keyword">return</span> tester.fail(); &#125;</span><br><span class="line"> <span class="keyword">if</span> (verbs[<span class="number">0</span>] !== <span class="string">&#x27;POST&#x27;</span>) &#123; <span class="keyword">return</span> tester.fail(); &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> .on(<span class="string">&#x27;error&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line"> <span class="built_in">console</span>.error(err);</span><br><span class="line"> <span class="keyword">return</span> tester.fail();</span><br><span class="line"> &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>In this case, the resolution to the<br>CSRF bug was that the endpoint should only accept HTTP POST requests. The regres‐<br>sion test ensures that the endpoint changeSubscriptionTier only takes a single<br>HTTP verb, and that verb is equal to POST. If a change in the future introduces a nonPOST version of that endpoint, or the fix is overwritten, then this test will fail, indi‐<br>cating that the vulnerability has regressed.<br>#Responsible Disclosure Programs</p>


    <!-- Social share choices -->
    
  <div id="social-share">
    <a data-url="http://example.com/2020/09/17/Vulnerability%20Discvoery/" target="_blank" rel="noopener" href="https://plus.google.com/share?url=" class="googleplus"><img src="/image/googleplusicon.png" alt=""/></a>
    <a data-url="http://example.com/2020/09/17/Vulnerability%20Discvoery/" target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?url=" class="twitter"><img src="/image/twittericon.png" alt=""/></a>
    <a data-url="http://example.com/2020/09/17/Vulnerability%20Discvoery/" target="_blank" rel="noopener" href="http://pinterest.com/pin/create/button/?url=" class="pinterest"><img src="/image/pinteresticon.png" alt=""/></a>
    <a data-url="http://example.com/2020/09/17/Vulnerability%20Discvoery/" target="_blank" rel="noopener" href="https://www.facebook.com/sharer/sharer.php?u=" class="facebook"><img src="/image/facebookicon.png" alt=""/></a>
  </div>





<!--


https://www.facebook.com/sharer/sharer.php?u=http://example.com/2020/09/17/Vulnerability%20Discvoery/
http://example.com/2020/09/17/Vulnerability%2520Discvoery/
-->



    <hr />


    <!-- Tags and Categories links -->
    

    


    <!-- Comment using disqus -->
    

</div>
</div>


  </div>
  <!-- Footer -->
  <div id="footer">
  <div id="footer-social">
    
    
    <a href="https://github.com/https://github.com/caketi" target="_blank"><img src="/image/githubicon.png" alt=""/></a>
    
    
    
    
    
</div>

  <p id="footer-info">
    &copy; 2020 caketi<br>
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> -
    Theme <a href="https://github.com/Suolawangzai/hexo-theme-nebula" target="_blank">nebula</a>
  </p>

  <div id="busuanzi">
    <span id="busuanzi_container_site_pv">
      &hearts;
    Total visits: <span id="busuanzi_value_site_pv"></span>
    </span>
  </div>
  <!--
  <div id="footer-info">
    &copy; 2020 caketi<br>
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
  </div>
-->
</div>

  <!-- After footer scripts -->
  <!-- Disqus Comments -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="/js/main.js"></script>


</body>

</html>
